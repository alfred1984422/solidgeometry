<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç«‹é«”å¹¾ä½•ï¼šè­‰æ˜é‚è¼¯éˆç‰¹è¨“ï¼ˆä¿®å¾©ç‰ˆï¼‰</title>
    <style>
        :root {
            --level-1-color: #10b981; /* å…·è±¡å±¤ - ç¶ è‰² */
            --level-2-color: #3b82f6; /* è¦ç¯„å±¤ - è—è‰² */
            --level-3-color: #6366f1; /* å¼·åŒ–å±¤ - é›é’ */
            --level-4-color: #8b5cf6; /* é«˜éšå±¤ - ç´«è‰² */
            --level-5-color: #ec4899; /* é·ç§»å±¤ - ç²‰ç´… */
            --bg: #f8fafc;
            --panel: #ffffff;
            --text: #334155;
            --selected-bg: #fff7ed;
            --selected-border: #f97316;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            height: 100vh;
            height: 100dvh;
            color: var(--text);
            overflow: hidden;
        }

        /* å·¦å´ï¼šäº’å‹•å¹¾ä½•å€ */
        #visual-area {
            flex: 1.2;
            background: radial-gradient(circle at center, #ffffff 0%, #f1f5f9 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            border-right: 1px solid #cbd5e1;
            transition: all 0.3s ease;
        }

        svg {
            width: 95%;
            height: 90%;
            max-width: 800px;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05));
            touch-action: none;
        }

        .vertex { fill: #1e293b; cursor: pointer; transition: r 0.2s; }
        .vertex:hover { r: 8; fill: var(--level-2-color); }
        .vertex-label { font-size: 16px; font-weight: bold; pointer-events: none; user-select: none; }
        .geo-line { stroke: #475569; stroke-width: 2; stroke-linecap: round; }
        .geo-dashed { stroke-dasharray: 6,4; opacity: 0.6; }
        .geo-aux { stroke: var(--level-4-color); stroke-width: 3; stroke-dasharray: 4,2; animation: dash 1s linear infinite; display: none; }
        .geo-highlight { stroke: var(--level-1-color); stroke-width: 4; opacity: 0.6; }
        
        @keyframes dash { to { stroke-dashoffset: -12; } }

        /* å³å´ï¼šé‚è¼¯æ§åˆ¶å€ */
        #control-panel {
            flex: 1;
            padding: 20px;
            background: var(--panel);
            display: flex;
            flex-direction: column;
            box-shadow: -5px 0 15px rgba(0,0,0,0.05);
            overflow-y: auto;
            position: relative;
            z-index: 10;
        }

        /* æ‰‹æ©Ÿç«¯é©é…ä½ˆå±€ */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            #visual-area {
                flex: none;
                height: 38vh;
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
            }
            #control-panel {
                flex: 1;
                height: 62vh;
                padding: 15px;
                box-shadow: 0 -5px 15px rgba(0,0,0,0.05);
            }
            h1 { font-size: 18px; margin-bottom: 5px; }
            .sub-title { font-size: 12px; margin-bottom: 10px; }
            .instruction-box { font-size: 13px; padding: 10px; margin-bottom: 10px; }
            .vertex { r: 6; }
            .vertex-label { font-size: 14px; }
        }

        /* é€²åº¦æŒ‡ç¤ºå™¨ */
        .stage-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            position: relative;
            padding: 0 5px;
        }
        .stage-indicator::before {
            content: ''; position: absolute; top: 12px; left: 10px; right: 10px; height: 2px; background: #e2e8f0; z-index: 0;
        }
        .stage-dot {
            width: 26px; height: 26px; border-radius: 50%; background: #fff; border: 2px solid #cbd5e1;
            z-index: 1; display: flex; justify-content: center; align-items: center; font-weight: bold; color: #94a3b8;
            transition: all 0.3s;
            font-size: 12px;
        }
        .stage-dot.active { transform: scale(1.2); color: white; border-color: transparent; }
        
        /* æ¨™é¡Œèˆ‡æŒ‡å¼• */
        h1 { font-size: 20px; margin: 0 0 8px 0; color: #1e293b; }
        .sub-title { font-size: 13px; color: #64748b; margin-bottom: 15px; line-height: 1.4; }
        .instruction-box {
            background: #f0f9ff; border-left: 4px solid var(--level-2-color); padding: 12px; border-radius: 4px; margin-bottom: 15px; font-size: 14px; color: #334155;
        }

        /* äº’å‹•å…ƒç´ å®¹å™¨ */
        #interaction-zone {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-bottom: 60px;
        }

        /* æ‹–æ‹½å¡Šæ¨£å¼ (å„ªåŒ–ç‚ºé»æ“Šç§»å‹•) */
        .draggable-container {
            min-height: 120px;
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 8px;
            transition: background 0.2s;
        }
        .draggable-container.highlight-target {
            background: #ecfccb;
            border-color: #84cc16;
        }

        .logic-block {
            padding: 12px;
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
            user-select: none;
            display: flex;
            align-items: center;
        }
        .logic-block:hover { border-color: var(--level-2-color); }
        .logic-block.selected { 
            background-color: var(--selected-bg); 
            border-color: var(--selected-border);
            box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.2);
            transform: scale(1.01);
        }
        
        /* ç­–ç•¥æŒ‰éˆ• */
        .strategy-btn {
            padding: 15px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 8px;
        }
        .strategy-btn:active { background: #f1f5f9; }
        .strategy-btn.selected { background: var(--level-5-color); color: white; border-color: var(--level-5-color); }
        .strategy-btn.selected span { color: rgba(255,255,255,0.9); }

        /* åº•éƒ¨å›ºå®šæŒ‰éˆ•å€ */
        .bottom-bar {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            padding: 15px;
            background: rgba(255,255,255,0.95);
            border-top: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .action-btn {
            width: 100%;
            padding: 14px;
            background: #334155;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .action-btn:disabled { background: #cbd5e1; cursor: not-allowed; box-shadow: none; }
        .action-btn.success { background: #10b981; }

        /* åé¥‹å½ˆçª— */
        #feedback {
            margin-bottom: 10px;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            min-height: 18px;
        }

        .mobile-hint {
            display: block;
            text-align: center;
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 5px;
        }

    </style>
</head>
<body>

    <div id="visual-area">
        <svg id="geo-svg" viewBox="0 0 500 400" preserveAspectRatio="xMidYMid meet">
            </svg>
        <div style="position: absolute; bottom: 10px; color: #64748b; font-size: 12px; background: rgba(255,255,255,0.8); padding: 2px 8px; border-radius: 10px;">
            æç¤ºï¼šå¯ç¸®æ”¾æŸ¥çœ‹åœ–å½¢
        </div>
    </div>

    <div id="control-panel">
        <div class="stage-indicator">
            <div class="stage-dot" id="dot-0">1</div>
            <div class="stage-dot" id="dot-1">2</div>
            <div class="stage-dot" id="dot-2">3</div>
            <div class="stage-dot" id="dot-3">4</div>
            <div class="stage-dot" id="dot-4">5</div>
        </div>

        <h1 id="level-title">é¡Œç›®åŠ è¼‰ä¸­...</h1>
        <div class="sub-title" id="level-desc"></div>

        <div class="instruction-box" id="instruction"></div>

        <div id="interaction-zone"></div>

        <div class="bottom-bar">
            <div id="feedback"></div>
            <button class="action-btn" id="next-btn" onclick="checkAndNext()">é©—è­‰ç­”æ¡ˆ</button>
        </div>
    </div>

    <script>
        // === é¡Œç›®æ•¸æ“šåº« ===
        const levels = [
            {
                id: 1,
                title: "1. å…·è±¡é—œè¯ï¼šä¸­é»çš„ç›´è¦º",
                desc: "ã€åŸºç¤å±¤ã€‘æ‰¾å‡ºæ§‹æˆã€Œç·šç·šå¹³è¡Œã€çš„é—œéµå…ƒç´ ã€‚",
                instruction: "è«‹ç›´æ¥é»æ“Šåœ–å½¢ä¸­ æ£± SA çš„ä¸­é» E å’Œ æ£± SC çš„ä¸­é» Fã€‚",
                points: {
                    S: [250, 50], A: [100, 350], B: [250, 400], C: [400, 350],
                    E: [175, 200], F: [325, 200]
                },
                lines: [
                    ['S','A'], ['S','B'], ['S','C'], ['A','B'], ['B','C'], ['A','C', true]
                ],
                targetPoints: ['E', 'F'],
                correctMsg: "æ­£ç¢ºï¼ä¸­ä½ç·š EF // AC æ˜¯è­‰æ˜çš„èµ·é»ã€‚",
                color: "#10b981",
                type: "click"
            }, // æ³¨æ„é€™è£¡çš„é€—è™Ÿ
            {
                id: 2,
                title: "2. æ­¥é©Ÿè¦ç¯„ï¼šä¸­ä½ç·šé‚è¼¯",
                desc: "ã€åŸºç¤å±¤ã€‘å°‡è­‰æ˜æ­¥é©Ÿæ’åºã€‚é»æ“Šé¸ä¸­èªå¥ï¼Œå†é»æ“Šç›®æ¨™å€æ”¾å…¥ã€‚",
                instruction: "é¡Œç›®ï¼šå·²çŸ¥ M æ˜¯ PC ä¸­é»ï¼ŒO æ˜¯ AC ä¸­é»ã€‚æ±‚è­‰ï¼šPA // å¹³é¢ BMDã€‚",
                points: {
                    P: [250, 50], A: [150, 300], B: [350, 300], C: [400, 200], D: [200, 200],
                    O: [275, 250], M: [325, 125]
                },
                lines: [
                    ['P','A'], ['P','B'], ['P','C'], ['P','D'],
                    ['A','B'], ['B','C'], ['C','D', true], ['D','A', true],
                    ['A','C', true], ['B','D', true]
                ],
                blocks: [
                    { id: 'b1', text: "é€£æ¥ AC, BD äº¤æ–¼é» O" },
                    { id: 'b2', text: "å› ç‚º ABCD æ˜¯å¹³è¡Œå››é‚Šå½¢ï¼ŒO ç‚º AC ä¸­é»" },
                    { id: 'b3', text: "åœ¨ â–³PAC ä¸­ï¼ŒO, M åˆ†åˆ¥ç‚ºä¸­é»" },
                    { id: 'b4', text: "æ‰€ä»¥ OM // PA (ä¸­ä½ç·š)" },
                    { id: 'b5', text: "åˆ OM âŠ‚ å¹³é¢ BMDï¼ŒPA âŠ„ å¹³é¢ BMD" },
                    { id: 'b6', text: "æ‰€ä»¥ PA // å¹³é¢ BMD" }
                ],
                correctOrder: ['b1', 'b2', 'b3', 'b4', 'b5', 'b6'],
                correctMsg: "é‚è¼¯æ»¿åˆ†ï¼é€™æ˜¯æ¨™æº–çš„è­‰æ˜çµæ§‹ã€‚",
                color: "#3b82f6",
                type: "sort"
            }, // æ³¨æ„é€™è£¡çš„é€—è™Ÿ
            {
                id: 3,
                title: "3. æ­¥é©Ÿè¦ç¯„ï¼šæ§‹é€ å¹³è¡Œå››é‚Šå½¢",
                desc: "ã€é€²éšå±¤ã€‘é»æ“Šé¸ä¸­èªå¥ï¼ŒæŒ‰é‚è¼¯é †åºç§»å…¥ä¸‹æ–¹ã€‚",
                instruction: "é¡Œç›®ï¼šE ç‚º CD ä¸­é»ï¼ŒF ç‚º PB ä¸­é»ã€‚æ±‚è­‰ï¼šEF // å¹³é¢ PADã€‚",
                points: {
                    P: [250, 50], A: [100, 300], B: [350, 300], C: [400, 200], D: [150, 200],
                    E: [275, 200], F: [300, 175], G: [175, 175]
                },
                lines: [
                    ['P','A'], ['P','B'], ['P','C'], ['P','D'],
                    ['A','B'], ['B','C'], ['C','D', true], ['D','A', true],
                    ['E','F', true]
                ],
                blocks: [
                    { id: 's1', text: "å– PA ä¸­é» Gï¼Œé€£æ¥ FG, DG" },
                    { id: 's2', text: "åœ¨ â–³PAB ä¸­ï¼ŒF, G ç‚ºä¸­é» â‡’ FG // AB ä¸” FG = Â½AB" },
                    { id: 's3', text: "å·²çŸ¥ E ç‚º CD ä¸­é» â‡’ DE // AB ä¸” DE = Â½AB" },
                    { id: 's4', text: "âˆ´ FG // DE ä¸” FG = DE â‡’ DEFG ç‚ºå¹³è¡Œå››é‚Šå½¢" },
                    { id: 's5', text: "âˆ´ EF // DG" },
                    { id: 's6', text: "åˆ DG âŠ‚ å¹³é¢ PADï¼ŒEF âŠ„ å¹³é¢ PAD â‡’ EF // å¹³é¢ PAD" }
                ],
                correctOrder: ['s1', 's2', 's3', 's4', 's5', 's6'],
                correctMsg: "æ¼‚äº®ï¼æˆåŠŸæ§‹é€ äº†å¹³è¡Œå››é‚Šå½¢ã€‚",
                color: "#6366f1",
                type: "sort"
            }, // æ³¨æ„é€™è£¡çš„é€—è™Ÿ
            {
                id: 4,
                title: "4. æ­¥é©Ÿè¦ç¯„ï¼šéš±è—çš„ä¸­é»",
                desc: "ã€é«˜éšå±¤ã€‘æ­£æ–¹å½¢å°è§’ç·šäº¤é»å³ä¸­é»ã€‚",
                instruction: "é¡Œç›®ï¼šP ç‚ºå¤–ä¸€é»ï¼ŒM, N åˆ†åˆ¥ç‚º PA, BD ä¸­é»ã€‚æ±‚è­‰ï¼šMN // å¹³é¢ PBCã€‚",
                points: {
                    P: [200, 50], A: [100, 300], B: [300, 300], C: [350, 200], D: [150, 200],
                    M: [150, 175], N: [225, 250]
                },
                lines: [
                    ['P','A'], ['P','B'], ['P','C'], ['P','D'],
                    ['A','B'], ['B','C'], ['C','D', true], ['D','A', true],
                    ['B','D', true], ['M','N', true]
                ],
                blocks: [
                    { id: 'c1', text: "é€£æ¥ ACï¼Œè¨­ AC äº¤ BD æ–¼é» O" },
                    { id: 'c2', text: "å› ç‚º ABCD ç‚ºæ­£æ–¹å½¢ï¼Œå°è§’ç·šäº’ç›¸å¹³åˆ† â‡’ N ç‚º AC ä¸­é»" },
                    { id: 'c3', text: "åœ¨ â–³PAC ä¸­ï¼ŒM ç‚º PA ä¸­é»ï¼ŒN ç‚º AC ä¸­é»" },
                    { id: 'c4', text: "ç”±ä¸‰è§’å½¢ä¸­ä½ç·šå®šç† â‡’ MN // PC" },
                    { id: 'c5', text: "åˆ PC âŠ‚ å¹³é¢ PBCï¼ŒMN âŠ„ å¹³é¢ PBC" },
                    { id: 'c6', text: "âˆ´ MN // å¹³é¢ PBC" }
                ],
                correctOrder: ['c1', 'c2', 'c3', 'c4', 'c5', 'c6'],
                correctMsg: "å¤ªæ£’äº†ï¼ç™¼ç¾äº†éš±å«çš„ä¸­é»æ¢ä»¶ã€‚",
                color: "#8b5cf6",
                type: "sort"
            }, // æ³¨æ„é€™è£¡çš„é€—è™Ÿ
            {
                id: 5,
                title: "5. é‚è¼¯é·ç§»ï¼šç­–ç•¥é¸æ“‡",
                desc: "ã€æŒ‘æˆ°å±¤ã€‘é¢å°è¤‡é›œåœ–å½¢ï¼Œé¸æ“‡æ­£ç¢ºç­–ç•¥ã€‚",
                instruction: "é¡Œç›®ï¼šä¸‰æ£±æŸ±ä¸­ï¼ŒE, F åˆ†åˆ¥æ˜¯ AB, AC ä¸­é»ã€‚æ±‚è­‰ï¼šå¹³é¢ EFA' // å¹³é¢ BC...ï¼Ÿ",
                points: {
                    A1: [150, 50], B1: [350, 50], C1: [100, 150],
                    A: [150, 250], B: [350, 250], C: [100, 350],
                    E: [250, 250], F: [125, 300]
                },
                lines: [
                    ['A','B'], ['B','C'], ['C','A', true],
                    ['A1','B1'], ['B1','C1'], ['C1','A1'],
                    ['A','A1'], ['B','B1'], ['C','C1'],
                    ['E','F', true]
                ],
                strategies: [
                    { id: 'strat1', title: "ç­–ç•¥ Aï¼šå°‹æ‰¾ç·šç·šå¹³è¡Œ (ä¸­ä½ç·š)", detail: "åˆ©ç”¨ E, F ç‚ºä¸­é»ï¼Œè­‰æ˜ EF // BCï¼Œé€²è€Œè­‰ EF // å¹³é¢...", correct: true },
                    { id: 'strat2', title: "ç­–ç•¥ Bï¼šæ§‹é€ ç·šé¢å‚ç›´", detail: "å˜—è©¦è­‰æ˜ A'A å‚ç›´æ–¼åº•é¢...", correct: false },
                    { id: 'strat3', title: "ç­–ç•¥ Cï¼šåˆ©ç”¨é«”å°è§’ç·š", detail: "é€£æ¥ A'B å’Œ BC'...", correct: false }
                ],
                correctMsg: "å“è¶Šçš„æ´å¯ŸåŠ›ï¼æŒæ¡äº†é¢é¢å¹³è¡Œçš„æ ¸å¿ƒé‚è¼¯ã€‚",
                color: "#ec4899",
                type: "select"
            }
        ];

        let currentLevelIndex = 0;
        let clickedPoints = [];
        let selectedBlock = null; 
        let selectedStrategy = null;

        // === åˆå§‹åŒ– ===
        function init() {
            renderLevel(0);
        }

        // === æ¸²æŸ“é—œå¡ ===
        function renderLevel(index) {
            currentLevelIndex = index;
            const level = levels[index];
            selectedBlock = null;
            
            // UI æ›´æ–°
            document.getElementById('level-title').innerText = level.title;
            document.getElementById('level-title').style.color = level.color;
            document.getElementById('level-desc').innerText = level.desc;
            document.getElementById('instruction').innerText = level.instruction;
            document.getElementById('feedback').innerText = "";
            const nextBtn = document.getElementById('next-btn');
            nextBtn.disabled = true;
            nextBtn.classList.remove('success');
            nextBtn.innerText = "é©—è­‰ç­”æ¡ˆ";
            nextBtn.style.background = "#334155"; 

            // æŒ‡ç¤ºå™¨
            document.querySelectorAll('.stage-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
                dot.style.background = (i === index) ? level.color : (i < index ? level.color : '#fff');
                dot.style.color = (i <= index) ? '#fff' : '#94a3b8';
                dot.style.opacity = (i < index) ? 0.6 : 1;
            });

            // ç¹ªåœ–
            drawGeometry(level);

            // æ¸²æŸ“äº’å‹•å€
            const zone = document.getElementById('interaction-zone');
            zone.innerHTML = '';

            if (level.type === "click") {
                clickedPoints = [];
            } else if (level.type === "sort") {
                renderSortInteraction(zone, level);
            } else if (level.type === "select") {
                renderStrategies(zone, level);
            }
        }

        // === ç¹ªåœ– ===
        function drawGeometry(level) {
            const svg = document.getElementById('geo-svg');
            svg.innerHTML = ''; 

            level.lines.forEach(lineDef => {
                const [start, end, dashed] = lineDef;
                const p1 = level.points[start];
                const p2 = level.points[end];
                
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", p1[0]); line.setAttribute("y1", p1[1]);
                line.setAttribute("x2", p2[0]); line.setAttribute("y2", p2[1]);
                line.setAttribute("class", "geo-line" + (dashed ? " geo-dashed" : ""));
                svg.appendChild(line);
            });

            for (const [key, val] of Object.entries(level.points)) {
                const isInteractive = (level.type === "click" && level.targetPoints.includes(key));
                
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", val[0]); circle.setAttribute("cy", val[1]);
                circle.setAttribute("r", isInteractive ? 10 : 4);
                circle.setAttribute("class", "vertex");
                
                if (isInteractive) {
                    circle.setAttribute("fill", "rgba(251, 191, 36, 0.8)");
                    circle.style.cursor = "pointer";
                    circle.onclick = () => handlePointClick(key, circle);
                } else {
                    circle.setAttribute("fill", "#1e293b");
                }
                svg.appendChild(circle);

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", val[0] + 12); text.setAttribute("y", val[1] + 4);
                text.setAttribute("class", "vertex-label");
                text.textContent = key;
                svg.appendChild(text);
            }
        }

        // === äº’å‹•: é»æ“Šé» ===
        function handlePointClick(key, element) {
            if (clickedPoints.includes(key)) return;
            clickedPoints.push(key);
            element.setAttribute("fill", levels[0].color);
            
            if (clickedPoints.length === 2) {
                const svg = document.getElementById('geo-svg');
                const p1 = levels[0].points[clickedPoints[0]];
                const p2 = levels[0].points[clickedPoints[1]];
                
                const auxLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
                auxLine.setAttribute("x1", p1[0]); auxLine.setAttribute("y1", p1[1]);
                auxLine.setAttribute("x2", p2[0]); auxLine.setAttribute("y2", p2[1]);
                auxLine.setAttribute("class", "geo-aux");
                auxLine.style.display = "block";
                svg.appendChild(auxLine);

                enableNextButton();
            }
        }

        // === äº’å‹•: æ’åº ===
        function renderSortInteraction(container, level) {
            const hint = document.createElement('span');
            hint.className = "mobile-hint";
            hint.innerText = "ğŸ‘† é»æ“Šé¸ä¸­èªå¥ï¼Œå†é»æ“Šä¸‹æ–¹ç©ºç™½è™•æ”¾å…¥";
            container.appendChild(hint);

            const sourceDiv = document.createElement('div');
            sourceDiv.className = 'draggable-container';
            sourceDiv.id = 'source-container';
            
            const targetDivLabel = document.createElement('div');
            targetDivLabel.innerHTML = '<strong>è­‰æ˜é‚è¼¯éˆ (æŒ‰é †åºæ”¾å…¥)ï¼š</strong>';
            targetDivLabel.style.fontSize = '14px';
            targetDivLabel.style.marginBottom = '5px';

            const sortArea = document.createElement('div');
            sortArea.className = 'draggable-container';
            sortArea.style.borderColor = level.color;
            sortArea.style.background = '#eff6ff';
            sortArea.id = 'target-container';
            sortArea.style.minHeight = '150px';

            const shuffled = [...level.blocks].sort(() => Math.random() - 0.5);

            shuffled.forEach(block => {
                const el = createBlockElement(block);
                sourceDiv.appendChild(el);
            });

            const handleContainerClick = (containerEl) => {
                containerEl.onclick = () => {
                    if (selectedBlock && selectedBlock.parentElement !== containerEl) {
                        containerEl.appendChild(selectedBlock);
                        selectedBlock.classList.remove('selected');
                        document.querySelectorAll('.draggable-container').forEach(c => c.classList.remove('highlight-target'));
                        selectedBlock = null;
                        
                        const inTarget = sortArea.querySelectorAll('.logic-block').length;
                        if (inTarget === level.blocks.length) {
                            enableNextButton();
                        }
                    }
                };
            };

            handleContainerClick(sourceDiv);
            handleContainerClick(sortArea);

            container.appendChild(sourceDiv);
            container.appendChild(targetDivLabel);
            container.appendChild(sortArea);
        }

        function createBlockElement(block) {
            const el = document.createElement('div');
            el.className = 'logic-block';
            el.innerText = block.text;
            el.id = block.id;
            
            el.onclick = (e) => {
                e.stopPropagation();
                if (selectedBlock === el) {
                    el.classList.remove('selected');
                    selectedBlock = null;
                    document.querySelectorAll('.draggable-container').forEach(c => c.classList.remove('highlight-target'));
                    return;
                }
                if (selectedBlock) selectedBlock.classList.remove('selected');
                selectedBlock = el;
                el.classList.add('selected');

                const currentContainer = el.parentElement;
                const otherContainer = currentContainer.id === 'source-container' 
                    ? document.getElementById('target-container') 
                    : document.getElementById('source-container');
                
                document.querySelectorAll('.draggable-container').forEach(c => c.classList.remove('highlight-target'));
                otherContainer.classList.add('highlight-target');
            };
            return el;
        }

        // === äº’å‹•: é¸æ“‡é¡Œ ===
        function renderStrategies(container, level) {
            selectedStrategy = null;
            level.strategies.forEach(strat => {
                const btn = document.createElement('div');
                btn.className = 'strategy-btn';
                btn.innerHTML = `<strong>${strat.title}</strong><br><span style="font-size:12px;color:#666">${strat.detail}</span>`;
                btn.onclick = () => {
                    document.querySelectorAll('.strategy-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedStrategy = strat;
                    enableNextButton();
                };
                container.appendChild(btn);
            });
        }

        function enableNextButton() {
            const btn = document.getElementById('next-btn');
            btn.disabled = false;
            btn.style.background = levels[currentLevelIndex].color;
        }

        function checkAndNext() {
            const btn = document.getElementById('next-btn');
            const feedback = document.getElementById('feedback');
            const level = levels[currentLevelIndex];
            let isCorrect = false;

            if (level.type === "click") {
                isCorrect = true;
            } else if (level.type === "sort") {
                const targetArea = document.getElementById('target-container');
                const userOrder = Array.from(targetArea.children).map(el => el.id);
                if (JSON.stringify(userOrder) === JSON.stringify(level.correctOrder)) {
                    isCorrect = true;
                } else {
                    feedback.innerText = "é †åºæœ‰èª¤ï¼Œè«‹æª¢æŸ¥é‚è¼¯ï¼šå·²çŸ¥ -> æ¨å° -> çµè«–ã€‚";
                    feedback.style.color = "#ef4444";
                    return;
                }
            } else if (level.type === "select") {
                if (selectedStrategy && selectedStrategy.correct) isCorrect = true;
                else {
                    feedback.innerText = "é€™ä¸æ˜¯æœ€å„ªè§£ï¼Œè«‹å†è©¦è©¦ã€‚";
                    feedback.style.color = "#ef4444";
                    return;
                }
            }

            if (isCorrect) {
                feedback.innerText = level.correctMsg;
                feedback.style.color = "#10b981";
                btn.classList.add('success');
                btn.innerText = (currentLevelIndex < levels.length - 1) ? "æ­£ç¢ºï¼ä¸‹ä¸€é—œ" : "æ­å–œé€šé—œï¼";
                
                const svg = document.getElementById('geo-svg');
                if (level.id === 2) { 
                    svg.appendChild(createAuxLine(level.points['O'], level.points['M']));
                } else if (level.id === 3) {
                    svg.appendChild(createAuxLine(level.points['G'], level.points['F']));
                    svg.appendChild(createAuxLine(level.points['D'], level.points['G']));
                } else if (level.id === 4) {
                    svg.appendChild(createAuxLine(level.points['A'], level.points['C']));
                    svg.appendChild(createAuxLine(level.points['B'], level.points['D']));
                }

                btn.onclick = () => {
                    if (currentLevelIndex < levels.length - 1) {
                        renderLevel(currentLevelIndex + 1);
                    } else {
                        alert("å¤ªæ£’äº†ï¼ä½ å·²ç¶“å®Œæˆäº†æ‰€æœ‰å¹¾ä½•é‚è¼¯ç‰¹è¨“ï¼");
                        location.reload();
                    }
                };
            }
        }

        function createAuxLine(p1, p2) {
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", p1[0]); line.setAttribute("y1", p1[1]);
            line.setAttribute("x2", p2[0]); line.setAttribute("y2", p2[1]);
            line.setAttribute("class", "geo-aux");
            line.style.display = "block";
            return line;
        }

        // å•Ÿå‹•
        init();

    </script>
</body>
</html>
